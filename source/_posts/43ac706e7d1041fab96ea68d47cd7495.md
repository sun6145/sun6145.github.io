---
layout: post
title: Nginxå®‰è£…æŒ‡å—
abbrlink: 43ac706e7d1041fab96ea68d47cd7495
tags:
  - nginx
categories:
  - Nginx
date: 1746081189378
updated: 1746462429749
---

è¯¦ç»†è®²è§£ Nginx åœ¨ Linux/Windows ç³»ç»Ÿçš„å®‰è£…æ­¥éª¤ï¼ŒåŒ…æ‹¬æºç ç¼–è¯‘å’ŒåŒ…ç®¡ç†å™¨ä¸¤ç§æ–¹å¼ã€‚æ¶µç›–åŸºç¡€é…ç½®æ£€æŸ¥ã€æœåŠ¡å¯åŠ¨åŠé˜²ç«å¢™è®¾ç½®ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ­å»ºé«˜æ€§èƒ½ Web æœåŠ¡å™¨ç¯å¢ƒã€‚é™„å¸¸è§é—®é¢˜è§£å†³æ–¹æ³•ï¼Œé€‚åˆè¿ç»´æ–°æ‰‹å…¥é—¨å‚è€ƒã€‚

<!-- more -->

***

## Nginx ç®€ä»‹

Nginxï¼ˆå‘éŸ³ä¸º "Engine-X"ï¼‰æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨ã€è´Ÿè½½å‡è¡¡å™¨ å’Œ HTTP ç¼“å­˜ å·¥å…·ã€‚å®ƒç”±ä¿„ç½—æ–¯ç¨‹åºå‘˜ Igor Sysoev äº 2004 å¹´é¦–æ¬¡å‘å¸ƒï¼Œç°å·²æˆä¸ºå…¨çƒæœ€æµè¡Œçš„ Web æœåŠ¡å™¨ä¹‹ä¸€ï¼Œä¸ Apache å¹¶é©¾é½é©±ã€‚

### Nginx çš„ä¸»è¦åŠŸèƒ½

- **Web æœåŠ¡å™¨**
  - å¯ä»¥æ‰˜ç®¡é™æ€ç½‘ç«™ï¼ˆHTMLã€CSSã€JSã€å›¾ç‰‡ç­‰ï¼‰ã€‚

  - æ”¯æŒ HTTP/1.1ã€HTTP/2 å’Œ HTTP/3ï¼ˆQUICï¼‰ã€‚

  - æ¯” Apache æ›´è½»é‡çº§ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚

- **åå‘ä»£ç†**
  - æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶è½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼ˆå¦‚ Tomcatã€Node.jsã€PHP-FPMï¼‰ã€‚
  - éšè—åç«¯æœåŠ¡å™¨ IPï¼Œæé«˜å®‰å…¨æ€§ã€‚

- **è´Ÿè½½å‡è¡¡**
  - å°†æµé‡åˆ†å‘åˆ°å¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œæé«˜å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚
  - æ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆè½®è¯¢ã€IP Hashã€æœ€å°‘è¿æ¥ç­‰ï¼‰ã€‚

- **HTTP ç¼“å­˜**
  - ç¼“å­˜é™æ€å†…å®¹ï¼Œå‡å°‘åç«¯æœåŠ¡å™¨å‹åŠ›ã€‚
  - å¯é…ç½®ç¼“å­˜ç­–ç•¥ï¼ˆå¦‚ `proxy_cache`ï¼‰ã€‚

- **TCP/UDP ä»£ç†**
  - ä»£ç†é HTTP æµé‡ï¼ˆå¦‚ MySQLã€Redisã€WebSocketï¼‰ã€‚
  - é€‚ç”¨äºæ•°æ®åº“ä»£ç†ã€æ¸¸æˆæœåŠ¡å™¨ç­‰ã€‚

- **SSL/TLS ç»ˆæ­¢**
  - å¤„ç† HTTPS åŠ å¯†å’Œè§£å¯†ï¼Œå‡è½»åç«¯æœåŠ¡å™¨è´Ÿæ‹…ã€‚
  - æ”¯æŒ Let's Encrypt å…è´¹è¯ä¹¦ã€‚

### Nginx vs. Apache

| ç‰¹æ€§   | Nginx            | Apache                 |
| ---- | ---------------- | ---------------------- |
| æ¶æ„   | äº‹ä»¶é©±åŠ¨ï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰      | å¤šè¿›ç¨‹/å¤šçº¿ç¨‹ï¼ˆé˜»å¡å¼ï¼‰           |
| æ€§èƒ½   | é«˜å¹¶å‘ï¼ˆ10K+ è¿æ¥ï¼‰     | é€‚åˆä½å¹¶å‘ä½†å¤æ‚åœºæ™¯             |
| å†…å­˜å ç”¨ | è¾ƒä½               | è¾ƒé«˜                     |
| é™æ€æ–‡ä»¶ | æ›´å¿«               | ç¨æ…¢                     |
| åŠ¨æ€å†…å®¹ | éœ€åå‘ä»£ç†ï¼ˆå¦‚ PHP-FPMï¼‰ | å†…ç½®æ¨¡å—ï¼ˆå¦‚ `mod_php`ï¼‰      |
| é…ç½®æ–¹å¼ | ç®€æ´ï¼ŒåŸºäº `location` | `.htaccess` æ–‡ä»¶         |
| é€‚ç”¨åœºæ™¯ | é«˜å¹¶å‘ã€åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡    | ä¼ ç»Ÿ Web åº”ç”¨ã€.htaccess éœ€æ±‚ |

## NginxäºŒè¿›åˆ¶åŒ…å®‰è£…

### Yumæºå®‰è£…

- **é…ç½®å®˜æ–¹ YUM ä»“åº“**

  ```sh
  [root@RockyLinux9 ~]# cat /etc/yum.repos.d/nginx.repo
  [nginx-stable]
  name=nginx stable repo
  baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
  gpgcheck=1
  enabled=1
  gpgkey=https://nginx.org/keys/nginx_signing.key
  module_hotfixes=true

  [root@RockyLinux9 ~]# dnf list nginx
  Available Packages
  nginx.x86_64                    1:1.26.0-1.el9.ngx                nginx-stable
  ```

- **å®‰è£…**

  ```sh
  [root@RockyLinux9 ~]# dnf install -y nginx
  # æœåŠ¡å¯åŠ¨å¹¶é…ç½®å¼€æœºè‡ªå¯
  [root@RockyLinux9 ~]# systemctl enable nginx --now
  # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
  [root@RockyLinux9 ~]# systemctl status nginx
  ```

### apt/yum/dnf

- Nginx ä¸€èˆ¬å¯ä»¥ä½¿ç”¨ apt/yum/dnf æ¥å®‰è£…äºŒè¿›åˆ¶åŒ…ï¼Œè‹¥éœ€ä½¿ç”¨ç‰¹å®šçš„åŠŸèƒ½æ¨¡å—ï¼Œåˆ™éœ€è¦ä½¿ç”¨æºç å®‰è£…ã€‚

  ```sh
  # æ£€æŸ¥å½“å‰ç³»ç»Ÿå¯å®‰è£…åˆ—è¡¨
  [root@RockyLinux9 ~]# dnf list nginx
  Available Packages
  nginx.x86_64                   1:1.20.1-14.el9_2.1                   appstream

  # å®‰è£…å¸¦streamæ¨¡å—çš„nginx
  sudo dnf install nginx-mod-stream
  ```

### æŸ¥çœ‹ç‰ˆæœ¬åŠé»˜è®¤ç¼–è¯‘ä¾èµ–é¡¹

```sh
[root@RockyLinux9 ~]# nginx -v/V(ç¼–è¯‘å‚æ•°)
nginx version: nginx/1.26.0
built by gcc 11.3.1 20221121 (Red Hat 11.3.1-4) (GCC)
built with OpenSSL 3.0.7 1 Nov 2022
TLS SNI support enabled
configure arguments: --prefix=/etc/nginx --sbin-path=//nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_v3_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt='-O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -fstack-protector-strong -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -march=x86-64-v2 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -fPIC' --with-ld-opt='-Wl,-z,relro -Wl,-z,now -pie'
```

### äºŒè¿›åˆ¶åŒ…å®‰è£…çš„é»˜è®¤ä½ç½®

```sh

rpm -q nginx (æŸ¥çœ‹æ˜¯å¦å®‰è£…)
rpm -ql nginx (æŸ¥çœ‹å…·ä½“å®‰è£…çš„è·¯å¾„)
rpm -qc nginx (æŸ¥çœ‹é…ç½®æ–‡ä»¶ä½ç½®)
```

å¦‚ä¸‹è¡¨æ ¼å¯¹Nginxå®‰è£…ç›®å½•åšè¯¦ç»†æ¦‚è¿°

| è·¯å¾„                                                                                                    | ç±»å‹   | ä½œç”¨                    |
| :---------------------------------------------------------------------------------------------------- | ---- | :-------------------- |
| /etc/nginx /etc/nginx/nginx.conf /etc/nginx/conf.d /etc/nginx/conf.d/default.conf                     | é…ç½®æ–‡ä»¶ | Nginxä¸»é…ç½®æ–‡ä»¶            |
| /etc/nginx/fastcgi\_params /etc/nginx/scgi\_params /etc/nginx/uwsgi\_params                           | é…ç½®æ–‡ä»¶ | Cgiã€Fastcgiã€Uwcgié…ç½®æ–‡ä»¶ |
| /etc/nginx/win-utf /etc/nginx/koi-utf /etc/nginx/koi-win                                              | é…ç½®æ–‡ä»¶ | Nginxç¼–ç è½¬æ¢æ˜ å°„æ–‡ä»¶         |
| /etc/nginx/mime.types                                                                                 | é…ç½®æ–‡ä»¶ | httpåè®®çš„Content-Type   |
| /etc/rc.d/init.d/nginx /etc/rc.d/init.d/nginx-debug /etc/sysconfig/nginx /etc/sysconfig/nginx-debug   | é…ç½®æ–‡ä»¶ | é…ç½®ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ç®¡ç†å™¨           |
| /etc/logrotate.d/nginx                                                                                | é…ç½®æ–‡ä»¶ | Nginxæ—¥å¿—è½®è¯¢,æ—¥å¿—åˆ‡å‰²        |
| /usr/sbin/nginx /usr/sbin/nginx-debug                                                                 | å‘½ä»¤   | Nginxç»ˆç«¯ç®¡ç†å‘½ä»¤           |
| /usr/share/doc/nginx-1.12.2 /usr/share/man/man8/nginx.8.gz                                            | ç›®å½•   | Nginxçš„å¸®åŠ©æ‰‹å†Œ            |
| /var/cache/nginx                                                                                      | ç›®å½•   | Nginxçš„ç¼“å­˜ç›®å½•            |
| /var/log/nginx                                                                                        | ç›®å½•   | Nginxçš„æ—¥å¿—ç›®å½•            |
| /etc/nginx/modules /usr/lib64/nginx /usr/lib64/nginx/modules                                          | ç›®å½•   | Nginxæ¨¡å—ç›®å½•             |
| /usr/share/nginx /usr/share/nginx/html /usr/share/nginx/html/50x.html/usr/share/nginx/html/index.html | ç›®å½•   | Nginxé»˜è®¤ç«™ç‚¹ç›®å½•           |

## Nginxå¸¸ç”¨æ¨¡å—

Nginxæ¨¡å—åˆ†ä¸º Nginxå®˜æ–¹æ¨¡å—ä»¥åŠNginxç¬¬ä¸‰æ–¹æ¨¡å—

| Nginxç¼–è¯‘é€‰é¡¹                      | æ¨¡å—ä½œç”¨                                    |
| :----------------------------- | :-------------------------------------- |
| ngx\_http\_core\_module        | åŒ…å«ä¸€äº›æ ¸å¿ƒçš„httpå‚æ•°é…ç½®ï¼Œå¯¹åº”Nginxçš„é…ç½®åŒºå—éƒ¨åˆ†          |
| ngx\_http\_access\_module      | è®¿é—®æ§åˆ¶æ¨¡å—ï¼Œç”¨æ¥æ§åˆ¶ç½‘ç«™ç”¨æˆ·å¯¹Nginxçš„è®¿é—®                |
| ngx\_http\_gzip\_module        | å‹ç¼©æ¨¡å—ï¼Œå¯¹Nginxè¿”å›çš„æ•°æ®å‹ç¼©ï¼Œå±äºæ€§èƒ½ä¼˜åŒ–æ¨¡å—             |
| ngx\_http\_fastcgi\_module     | fastciæ¨¡å—ï¼Œå’ŒåŠ¨æ€åº”ç”¨ç›¸å…³çš„æ¨¡å—ï¼Œä¾‹å¦‚PHP               |
| ngx\_http\_proxy\_module       | proxyä»£ç†æ¨¡å—                               |
| ngx\_http\_upstream\_module    | è´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œå¯ä»¥å®ç°ç½‘ç«™çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½åŠèŠ‚ç‚¹çš„å¥åº·æ£€æŸ¥ã€‚           |
| ngx\_http\_rewrite\_module     | URLåœ°å€é‡å†™æ¨¡å—                               |
| ngx\_http\_limit\_conn\_module | é™åˆ¶ç”¨æˆ·å¹¶å‘è¿æ¥æ•°åŠè¯·æ±‚æ•°æ¨¡å—                         |
| ngx\_http\_limit\_req\_module  | é™åˆ¶Nginx request processing rateæ ¹æ®å®šä¹‰çš„key |
| ngx\_http\_log\_module         | è®¿é—®æ—¥å¿—æ¨¡å—ï¼Œä»¥æŒ‡å®šçš„æ ¼å¼è®°å½•Nginxå®¢æˆ·è®¿é—®æ—¥å¿—ç­‰ä¿¡æ¯           |
| ngx\_http\_auth\_basic\_module | Webè®¤è¯æ¨¡å—ï¼Œè®¾ç½®Webç”¨æˆ·é€šè¿‡è´¦å·å¯†ç è®¿é—®Nginx            |
| nginx\_http\_ssl\_module       | sslæ¨¡å—ï¼Œç”¨äºåŠ å¯†çš„httpè¿æ¥ï¼Œå¦‚https                |

## æºç æ–¹å¼å®‰è£…

### ç®€å•ç¤ºä¾‹

1. é¦–å…ˆå®‰è£…ç¼–è¯‘ Nginx æ‰€éœ€çš„ä¾èµ–ï¼š

   ```sh
   sudo dnf install -y gcc make pcre-devel zlib-devel openssl-devel
   ```

2. [ä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆ Nginx æºç ](http://nginx.org/en/download.html)ï¼ˆä»¥ `1.25.3` ä¸ºä¾‹ï¼‰ï¼š

   ```sh
   wget http://nginx.org/download/nginx-1.25.3.tar.gz
   tar -zxvf nginx-1.25.3.tar.gz
   cd nginx-1.25.3
   ```

3. ç¼–è¯‘å®‰è£… Nginx,è¿è¡Œ `configure` å¹¶å¯ç”¨ HTTPS æ”¯æŒï¼ˆ`--with-http_ssl_module`ï¼‰ï¼š

   - `--prefix=/etc/nginx`ï¼šæŒ‡å®šå®‰è£…ç›®å½•

   - `--with-http_ssl_module`ï¼šå¯ç”¨ HTTPS æ”¯æŒ

   - `--with-http_v2_module`ï¼šæ”¯æŒ HTTP/2

   - `--with-http_stub_status_module`ï¼šå¯ç”¨ Nginx çŠ¶æ€ç›‘æ§\`

     ```sh
     # é…ç½®ç¼–è¯‘é€‰é¡¹â€‹â€‹ï¼š
     ./configure \
         --prefix=/etc/nginx \
         --with-http_ssl_module \
         --with-http_v2_module \
         --with-http_stub_status_module
     # â€‹â€‹ç¼–è¯‘å¹¶å®‰è£…â€‹â€‹ï¼š
     make && sudo make install
     ```

4. å¯åŠ¨Nginx

   ```sh
   /etc/nginx/sbin/nginx

   # éªŒè¯å®‰è£…â€‹â€‹ï¼š
   curl http://localhost
   ```

### æ–°å¢æ¨¡å—ç¤ºä¾‹

1. ä¸‹è½½å¹¶è§£å‹æºç ,

   ```sh
   wget http://nginx.org/download/nginx-1.25.3.tar.gz
   tar -zxvf nginx-1.25.3.tar.gz
   cd nginx-1.25.3
   ```

2. é…ç½®ç¼–è¯‘é€‰é¡¹ï¼šä¸ºå·²å®‰è£…çš„Nginxæ·»åŠ `http_realip_module`æ¨¡å—ï¼š

   ```sh
   # æŸ¥çœ‹å½“å‰ç¼–è¯‘å‚æ•°â€‹â€‹ï¼š
   /etc/nginx/sbin/nginx -V
   # â€‹â€‹é‡æ–°é…ç½®å¹¶æ·»åŠ æ¨¡å—â€‹â€‹ï¼š
   ./configure --prefix=/etc/nginx \
       --with-http_ssl_module \
       --with-http_stub_status_module \
       --with-http_realip_module
   ```

3. **ç¼–è¯‘ï¼ˆä¸å®‰è£…ï¼‰**

   ```sh
   make
   ```

4. **å¤‡ä»½å¹¶æ›¿æ¢äºŒè¿›åˆ¶æ–‡ä»¶**ï¼š

   ```sh
   mv /etc/nginx/sbin/nginx /etc/nginx/sbin/nginx.bak
   cp objs/nginx /etc/nginx/sbin/nginx
   ```

5. **é‡å¯Nginx**ï¼š

   ```sh
   /etc/nginx/sbin/nginx -s stop
   /etc/nginx/sbin/nginx
   ```

### Nginxå‡çº§ç¤ºä¾‹

1. å°†Nginxä»1.25.3å‡çº§åˆ°1.25.4ï¼š

   ```sh
   # ä¸‹è½½æ–°ç‰ˆæœ¬æºç â€‹â€‹ï¼š
   wget http://nginx.org/download/nginx-1.25.4.tar.gz
   tar -zxvf nginx-1.25.4.tar.gz
   cd nginx-1.25.4
   ```

2. **ä½¿ç”¨åŸç¼–è¯‘å‚æ•°é…ç½®**ï¼š

   ```sh
   ./configure --prefix=/etc/nginx \
       --with-http_ssl_module \
       --with-http_stub_status_module \
       --with-http_realip_module
   ```

3. ç¼–è¯‘ï¼š

   ```sh
   make
   ```

4. **å¤‡ä»½æ—§ç‰ˆæœ¬**ï¼š

   ```sh
   mv /etc/nginx/sbin/nginx /etc/nginx/sbin/nginx.old
   ```

5. **æ›¿æ¢äºŒè¿›åˆ¶æ–‡ä»¶**ï¼š

   ```sh
   cp objs/nginx /etc/nginx/sbin/nginx
   ```

6. **å¹³æ»‘å‡çº§**ï¼š

   ```sh
   make upgrade
   ```

7. éªŒè¯ç‰ˆæœ¬

   ```sh
   /etc/nginx/sbin/nginx -v
   ```

### é…ç½®Systemctlç®¡ç†

- åˆ›å»º systemd æœåŠ¡ï¼Œ `/etc/systemd/system/nginx.service`ï¼š

  ```sh
  sudo tee /etc/systemd/system/nginx.service <<EOF
  [Unit]
  Description=The nginx HTTP and reverse proxy server
  After=network.target

  [Service]
  Type=forking
  PIDFile=/etc/nginx/logs/nginx.pid
  ExecStart=/etc/nginx/sbin/nginx
  ExecReload=/etc/nginx/sbin/nginx -s reload
  ExecStop=/etc/nginx/sbin/nginx -s stop
  PrivateTmp=true

  [Install]
  WantedBy=multi-user.target
  EOF
  ```

- å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯

  ```sh
  sudo systemctl daemon-reload
  sudo systemctl start nginx
  sudo systemctl enable nginx
  ```

***

### Nginxå¸è½½

1. åœæ­¢NginxæœåŠ¡ï¼š

   ```sh
   /etc/nginx/sbin/nginx -s stop  # æ ¹æ®å®é™…å®‰è£…è·¯å¾„è°ƒæ•´
   # æˆ–è€…ä½¿ç”¨ç³»ç»ŸæœåŠ¡æ–¹å¼åœæ­¢
   systemctl stop nginx
   ```

2. æŸ¥æ‰¾å¹¶åˆ é™¤Nginxç›¸å…³æ–‡ä»¶ï¼š

   ```sh
   # æŸ¥æ‰¾æ‰€æœ‰nginxç›¸å…³æ–‡ä»¶
   find / -name "*nginx*"

   # åˆ é™¤å®‰è£…ç›®å½•ï¼ˆæ ¹æ®configureæ—¶æŒ‡å®šçš„--prefixè·¯å¾„ï¼‰
   rm -rf /etc/nginx  # é»˜è®¤å®‰è£…è·¯å¾„
   ```

3. åˆ é™¤æºç ç¼–è¯‘ç›®å½•ï¼ˆå¯é€‰ï¼‰ï¼š

   ```sh
   rm -rf /path/to/nginx-1.25.3  # æ›¿æ¢ä¸ºå®é™…æºç ç›®å½•
   ```

4. æ¸…ç†ç³»ç»ŸæœåŠ¡é…ç½®ï¼ˆå¦‚æœé…ç½®è¿‡ï¼‰ï¼š

   ```sh
   rm -f /etc/init.d/nginx
   rm -f /usr/lib/systemd/system/nginx.service
   systemctl daemon-reload
   ```

5. åˆ é™¤å¼€æœºå¯åŠ¨é¡¹ï¼š

   ```sh
   # å¦‚æœé…ç½®äº†rc.localå¯åŠ¨
   sed -i '/nginx/d' /etc/rc.local

   # å¦‚æœä½¿ç”¨systemd
   systemctl disable nginx
   ```

6. æ¸…ç†ç¯å¢ƒå˜é‡ï¼š ç¼–è¾‘`/etc/profile`æˆ–ç›¸åº”ç”¨æˆ·çš„`.bashrc`æ–‡ä»¶ï¼Œåˆ é™¤åŒ…å«nginxè·¯å¾„çš„PATHè®¾ç½®,å¦‚æœéœ€è¦é‡æ–°å®‰è£…ï¼Œå»ºè®®åœ¨åˆ é™¤åæ‰§è¡Œ`ldconfig`æ›´æ–°å…±äº«åº“ç¼“å­˜

## Nginxé»˜è®¤ç¼–è¯‘å‚æ•°

### å®‰è£…

```sh
./configure \
--prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_v3_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt='-O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -fstack-protector-strong -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -march=x86-64-v2 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -fPIC' --with-ld-opt='-Wl,-z,relro -Wl,-z,now -pie'
```

```sh
# ç›®å½•åˆ›å»º
sudo mkdir -p /var/cache/nginx/client_temp /var/cache/nginx/proxy_temp /var/cache/nginx/fastcgi_temp /var/cache/nginx/uwsgi_temp /var/cache/nginx/scgi_temp
# ä¿®æ”¹æƒé™
sudo chown -R nginx:nginx /var/cache/nginx
sudo chmod -R 755 /var/cache/nginx
```

```sh
sudo tee /etc/systemd/system/nginx.service <<EOF
[Unit]
Description=The NGINX HTTP and reverse proxy server
After=syslog.target network-online.target remote-fs.target nss-lookup.target
Wants=network-online.target

[Service]
Type=forking
PIDFile=/run/nginx.pid
ExecStartPre=/usr/sbin/nginx -t
ExecStart=/usr/sbin/nginx
ExecReload=/usr/sbin/nginx -s reload
ExecStop=/bin/kill -s QUIT $MAINPID
PrivateTmp=true

[Install]
WantedBy=multi-user.targe
EOF
```

### å‚æ•°è¯´æ˜

| å‚æ•°åç§°                                     | å¤‡æ³¨                                                                                                          |
| ---------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| `--prefix=value`                         | æŒ‡å‘å®‰è£…ç›®å½•                                                                                                      |
| `--sbin-path`                            | æŒ‡å‘ï¼ˆæ‰§è¡Œï¼‰ç¨‹åºæ–‡ä»¶ï¼ˆ`nginx`ï¼‰                                                                                         |
| `--conf-path=`                           | æŒ‡å‘é…ç½®æ–‡ä»¶ï¼ˆ`nginx.conf`ï¼‰                                                                                        |
| `--error-log-path=`                      | æŒ‡å‘é”™è¯¯æ—¥å¿—ç›®å½•                                                                                                    |
| `--pid-path=`                            | æŒ‡å‘ `pid` æ–‡ä»¶ï¼ˆ`nginx.pid`ï¼‰                                                                                    |
| `--lock-path=`                           | æŒ‡å‘ `lock` æ–‡ä»¶ï¼ˆ`nginx.lock`ï¼‰ï¼ˆå®‰è£…æ–‡ä»¶é”å®šï¼Œé˜²æ­¢å®‰è£…æ–‡ä»¶è¢«åˆ«äººåˆ©ç”¨ï¼Œæˆ–è‡ªå·±è¯¯æ“ä½œã€‚ï¼‰è¿›ç¨‹IDæ–‡ä»¶                                                |
| `--user=`                                | æŒ‡å®šç¨‹åºè¿è¡Œæ—¶çš„ç”¨æˆ·å                                                                                                 |
| `--group=`                               | æŒ‡å®šç¨‹åºè¿è¡Œæ—¶çš„ç”¨æˆ·ç»„å                                                                                                |
| `--builddir=`                            | æŒ‡å‘ç¼–è¯‘ç›®å½•                                                                                                      |
| `--with-rtsig_module`                    | å¯ç”¨ rtsig æ¨¡å—æ”¯æŒï¼ˆå®æ—¶ä¿¡å·ï¼‰                                                                                         |
| `--with-select_module`                   | å¯ç”¨ select æ¨¡å—æ”¯æŒï¼ˆä¸€ç§è½®è¯¢æ¨¡å¼,ä¸æ¨èåœ¨é«˜è½½ç¯å¢ƒä¸‹ä½¿ç”¨ï¼‰ç¦ç”¨ï¼š`--without-select_module`                                              |
| `--with-poll_module`                     | å¯ç”¨ poll æ¨¡å—æ”¯æŒï¼ˆåŠŸèƒ½ä¸ select ç›¸åŒï¼Œä¸ select ç‰¹æ€§ç›¸åŒï¼Œä¸ºä¸€ç§è½®è¯¢æ¨¡å¼,ä¸æ¨èåœ¨é«˜è½½ç¯å¢ƒä¸‹ä½¿ç”¨ï¼‰                                               |
| `--with-file-aio`                        | å¯ç”¨ file aio æ”¯æŒï¼ˆä¸€ç§ APL æ–‡ä»¶ä¼ è¾“æ ¼å¼ï¼‰                                                                               |
| `--with-ipv6`                            | å¯ç”¨ ipv6 æ”¯æŒ                                                                                                  |
| `--add-module=`                          | å¯ç”¨å¤–éƒ¨æ¨¡å—æ”¯æŒ                                                                                                    |
| `--with-cc=`                             | æŒ‡å‘ C ç¼–è¯‘å™¨è·¯å¾„                                                                                                  |
| `--with-cpp=`                            | æŒ‡å‘ C é¢„å¤„ç†è·¯å¾„                                                                                                  |
| `--with-cc-opt=`                         | è®¾ç½® C ç¼–è¯‘å™¨å‚æ•°                                                                                                  |
| `--with-ld-opt=`                         | è®¾ç½®è¿æ¥æ–‡ä»¶å‚æ•°                                                                                                    |
| `--with-cpu-opt=`                        | æŒ‡å®šç¼–è¯‘çš„ CPUï¼Œå¯ç”¨çš„å€¼ä¸ºï¼špentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64    |
| `--without-pcre`                         | ç¦ç”¨ PCRE åº“                                                                                                   |
| `--with-pcre`                            | å¯ç”¨ PCRE åº“                                                                                                   |
| `--with-pcre=`                           | æŒ‡å‘ PCRE åº“æ–‡ä»¶ç›®å½•                                                                                               |
| `--with-pcre-opt=`                       | åœ¨ç¼–è¯‘æ—¶ä¸º PCRE åº“è®¾ç½®é™„åŠ å‚æ•°                                                                                          |
| `--with-md5=`                            | æŒ‡å‘ MD5 åº“æ–‡ä»¶ç›®å½•ï¼ˆæ¶ˆæ¯æ‘˜è¦ç®—æ³•ç¬¬äº”ç‰ˆï¼Œç”¨ä»¥æä¾›æ¶ˆæ¯çš„å®Œæ•´æ€§ä¿æŠ¤ï¼‰                                                                        |
| `--with-md5-opt=`                        | åœ¨ç¼–è¯‘æ—¶ä¸º MD5 åº“è®¾ç½®é™„åŠ å‚æ•°                                                                                           |
| `--with-md5-asm`                         | ä½¿ç”¨ MD5 æ±‡ç¼–æº                                                                                                  |
| `--with-sha1=`                           | æŒ‡å‘ sha1 åº“ç›®å½•ï¼ˆæ•°å­—ç­¾åç®—æ³•ï¼Œä¸»è¦ç”¨äºæ•°å­—ç­¾åï¼‰                                                                                |
| `--with-sha1-opt=`                       | åœ¨ç¼–è¯‘æ—¶ä¸º sha1 åº“è®¾ç½®é™„åŠ å‚æ•°                                                                                          |
| `--with-sha1-asm`                        | ä½¿ç”¨ sha1 æ±‡ç¼–æº                                                                                                 |
| `--with-perl=`                           | è®¾å®š perl åº“æ–‡ä»¶è·¯å¾„                                                                                               |
| `--with-zlib=`                           | æŒ‡å‘ zlib åº“ç›®å½•                                                                                                 |
| `--with-zlib-opt=`                       | åœ¨ç¼–è¯‘æ—¶ä¸º zlib è®¾ç½®é™„åŠ å‚æ•°                                                                                           |
| `--with-zlib-asm=`                       | ä¸ºæŒ‡å®šçš„ CPU ä½¿ç”¨ zlib æ±‡ç¼–æºè¿›è¡Œä¼˜åŒ–ï¼ŒCPU ç±»å‹ä¸º pentium, pentiumpro                                                        |
| `--with-libatomic`                       | ä¸ºåŸå­å†…å­˜çš„æ›´æ–°æ“ä½œçš„å®ç°æä¾›ä¸€ä¸ªæ¶æ„                                                                                         |
| `--with-libatomic=`                      | æŒ‡å‘ libatomic\_ops å®‰è£…ç›®å½•                                                                                      |
| `--with-openssl=`                        | æŒ‡å‘ openssl å®‰è£…ç›®å½•                                                                                             |
| `--with-openssl-opt`                     | åœ¨ç¼–è¯‘æ—¶ä¸º openssl è®¾ç½®é™„åŠ å‚æ•°                                                                                        |
| `--with-debug`                           | å¯ç”¨ debug æ—¥å¿—                                                                                                 |
| `--with-http_ssl_module`                 | å¯ç”¨ ngx\_http\_ssl\_module æ”¯æŒï¼ˆä½¿æ”¯æŒ HTTPS è¯·æ±‚ï¼Œéœ€å·²å®‰è£… opensslï¼‰                                                     |
| `--with-http_realip_module`              | å¯ç”¨ ngx\_http\_realip\_module æ”¯æŒï¼ˆè¿™ä¸ªæ¨¡å—å…è®¸ä»è¯·æ±‚æ ‡å¤´æ›´æ”¹å®¢æˆ·ç«¯çš„ IP åœ°å€å€¼ï¼Œé»˜è®¤ä¸ºå…³ï¼‰                                              |
| `--with-http_addition_module`            | å¯ç”¨ ngx\_http\_addition\_module æ”¯æŒï¼ˆä½œä¸ºä¸€ä¸ªè¾“å‡ºè¿‡æ»¤å™¨ï¼Œæ”¯æŒä¸å®Œå…¨ç¼“å†²ï¼Œåˆ†éƒ¨åˆ†å“åº”è¯·æ±‚ï¼‰                                                |
| `--with-http_xslt_module`                | å¯ç”¨ ngx\_http\_xslt\_module æ”¯æŒï¼ˆè¿‡æ»¤è½¬æ¢ XML è¯·æ±‚ï¼‰                                                                  |
| `--with-http_image_filter_module`        | å¯ç”¨ ngx\_http\_image\_filter\_module æ”¯æŒï¼ˆä¼ è¾“ JPEG/GIF/PNG å›¾ç‰‡çš„ä¸€ä¸ªè¿‡æ»¤å™¨ï¼‰ï¼ˆé»˜è®¤ä¸ºä¸å¯ç”¨ã€‚GD åº“è¦ç”¨åˆ°ï¼‰                            |
| `--with-http_geoip_module`               | å¯ç”¨ ngx\_http\_geoip\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—åˆ›å»ºåŸºäºä¸ MaxMind GeoIP äºŒè¿›åˆ¶æ–‡ä»¶ç›¸é…çš„å®¢æˆ·ç«¯ IP åœ°å€çš„ ngx\_http\_geoip\_module å˜é‡ï¼‰       |
| `--with-http_sub_module`                 | å¯ç”¨ ngx\_http\_sub\_module æ”¯æŒï¼ˆå…è®¸ç”¨ä¸€äº›å…¶ä»–æ–‡æœ¬æ›¿æ¢ Nginx å“åº”ä¸­çš„ä¸€äº›æ–‡æœ¬ï¼‰                                                    |
| `--with-http_dav_module`                 | å¯ç”¨ ngx\_http\_dav\_module æ”¯æŒï¼ˆå¢åŠ  PUTã€DELETEã€MKCOL åˆ›å»ºé›†åˆï¼ŒCOPY å’Œ MOVE æ–¹æ³•ï¼‰é»˜è®¤æƒ…å†µä¸‹ä¸ºå…³é—­ï¼Œéœ€ç¼–è¯‘å¼€å¯                         |
| `--with-http_flv_module`                 | å¯ç”¨ ngx\_http\_flv\_module æ”¯æŒï¼ˆæä¾›å¯»æ±‚å†…å­˜ä½¿ç”¨åŸºäºæ—¶é—´çš„åç§»é‡æ–‡ä»¶ï¼‰                                                            |
| `--with-http_gzip_static_module`         | å¯ç”¨ ngx\_http\_gzip\_static\_module æ”¯æŒï¼ˆåœ¨çº¿å®æ—¶å‹ç¼©è¾“å‡ºæ•°æ®æµï¼‰                                                          |
| `--with-http_random_index_module`        | å¯ç”¨ `ngx_http_random_index_module` æ”¯æŒï¼ˆä»ç›®å½•ä¸­éšæœºæŒ‘é€‰ä¸€ä¸ªç›®å½•ç´¢å¼•ï¼‰                                                        |
| `--with-http_secure_link_module`         | å¯ç”¨ ngx\_http\_secure\_link\_module æ”¯æŒï¼ˆè®¡ç®—å’Œæ£€æŸ¥è¦æ±‚æ‰€éœ€çš„å®‰å…¨é“¾æ¥ç½‘å€ï¼‰                                                     |
| `--with-http_degradation_module`         | å¯ç”¨ ngx\_http\_degradation\_module æ”¯æŒï¼ˆå…è®¸åœ¨å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹è¿”å›204æˆ–444ç ï¼‰                                                 |
| `--with-http_stub_status_module`         | å¯ç”¨ ngx\_http\_stub\_status\_module æ”¯æŒï¼ˆè·å– Nginx è‡ªä¸Šæ¬¡å¯åŠ¨ä»¥æ¥çš„å·¥ä½œçŠ¶æ€ï¼‰                                                |
| `--without-http_charset_module`          | ç¦ç”¨ ngx\_http\_charset\_module æ”¯æŒï¼ˆé‡æ–°ç¼–ç  WEB é¡µé¢ï¼Œä½†åªèƒ½æ˜¯ä¸€ä¸ªæ–¹å‘--æœåŠ¡å™¨ç«¯åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªå­—èŠ‚çš„ç¼–ç å¯ä»¥è¢«é‡æ–°ç¼–ç ï¼‰                         |
| `--without-http_gzip_module`             | ç¦ç”¨ ngx\_http\_gzip\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—åŒ `--with-http_gzip_static_module` åŠŸèƒ½ä¸€æ ·ï¼‰                                   |
| `--without-http_ssi_module`              | ç¦ç”¨ ngx\_http\_ssi\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—æä¾›äº†ä¸€ä¸ªåœ¨è¾“å…¥ç«¯å¤„ç†å¤„ç†æœåŠ¡å™¨åŒ…å«æ–‡ä»¶ï¼ˆSSIï¼‰çš„è¿‡æ»¤å™¨ï¼Œç›®å‰æ”¯æŒ SSI å‘½ä»¤çš„åˆ—è¡¨æ˜¯ä¸å®Œæ•´çš„ï¼‰                          |
| `--without-http_userid_module`           | ç¦ç”¨ ngx\_http\_userid\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥å¤„ç†ç”¨æ¥ç¡®å®šå®¢æˆ·ç«¯åç»­è¯·æ±‚çš„ `cookie` ï¼‰                                              |
| `--without-http_access_module`           | ç¦ç”¨ ngx\_http\_access\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—æä¾›äº†ä¸€ä¸ªç®€å•çš„åŸºäºä¸»æœºçš„è®¿é—®æ§åˆ¶ã€‚å…è®¸/æ‹’ç»åŸºäº IP åœ°å€ï¼‰                                         |
| `--without-http_auth_basic_module`       | ç¦ç”¨ ngx\_http\_auth\_basic\_moduleï¼ˆè¯¥æ¨¡å—æ˜¯å¯ä»¥ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç åŸºäº HTTP åŸºæœ¬è®¤è¯æ–¹æ³•æ¥ä¿æŠ¤ä½ çš„ç«™ç‚¹æˆ–å…¶éƒ¨åˆ†å†…å®¹ï¼‰                                |
| `--without-http_autoindex_module`        | ç¦ç”¨ ngx\_http\_autoindex\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨äºè‡ªåŠ¨ç”Ÿæˆç›®å½•åˆ—è¡¨ï¼Œåªåœ¨ `ngx_http_index_module` æ¨¡å—æœªæ‰¾åˆ°ç´¢å¼•æ–‡ä»¶æ—¶å‘å‡ºè¯·æ±‚ã€‚ï¼‰                |
| `--without-http_geo_module`              | ç¦ç”¨ ngx\_http\_geo\_module æ”¯æŒï¼ˆåˆ›å»ºä¸€äº›å˜é‡ï¼Œå…¶å€¼ä¾èµ–äºå®¢æˆ·ç«¯çš„IPåœ°å€ï¼‰                                                          |
| `--without-http_map_module`              | ç¦ç”¨ ngx\_http\_map\_module æ”¯æŒï¼ˆä½¿ç”¨ä»»æ„çš„é”®/å€¼å¯¹è®¾ç½®é…ç½®å˜é‡ï¼‰                                                               |
| `--without-http_split_clients_module`    | ç¦ç”¨ ngx\_http\_split\_clients\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥åŸºäºæŸäº›æ¡ä»¶åˆ’åˆ†ç”¨æˆ·ã€‚æ¡ä»¶å¦‚ï¼šipåœ°å€ã€æŠ¥å¤´ã€cookiesç­‰ç­‰ï¼‰                              |
| `--without-http_referer_module`          | ç¦ç”¨ ngx\_http\_referer\_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥è¿‡æ»¤è¯·æ±‚ï¼Œæ‹’ç»æŠ¥å¤´ä¸­ Referer å€¼ä¸æ­£ç¡®çš„è¯·æ±‚ï¼‰                                            |
| `--without-http_rewrite_module`          | ç¦ç”¨ ngx\_http\_rewrite\_module ï¼Œé“¾æ¥é‡å†™                                                                         |
| `--without-http_proxy_module`            | ç¦ç”¨ ngx\_http\_proxy\_module æ”¯æŒï¼ˆæœ‰å…³ä»£ç†æœåŠ¡å™¨ï¼‰                                                                     |
| `--without-http_fastcgi_module`          | ç¦ç”¨ ngx\_http\_fastcgi\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—å…è®¸ Nginx ä¸ FastCGI è¿›ç¨‹äº¤äº’ï¼Œå¹¶é€šè¿‡ä¼ é€’å‚æ•°æ¥æ§åˆ¶ FastCGI è¿›ç¨‹å·¥ä½œã€‚ ï¼‰FastCGI ä¸€ä¸ªå¸¸é©»å‹çš„å…¬å…±ç½‘å…³æ¥å£ã€‚ |
| `--without-http_uwsgi_module`            | ç¦ç”¨ ngx\_http\_uwsgi\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥åŒ»ç”¨uwsgiåè®®ï¼ŒuWSGIæœåŠ¡å™¨ç›¸å…³ï¼‰                                                   |
| `--without-http_scgi_module`             | ç¦ç”¨ ngx\_http\_scgi\_moduleæ”¯æŒ                                                                                |
| `--without-http_memcached_module`        | ç¦ç”¨ ngx\_http\_memcached\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥æä¾›ç®€å•çš„ç¼“å­˜ï¼Œä»¥æé«˜ç³»ç»Ÿæ•ˆç‡ï¼‰                                                    |
| `-without-http_limit_zone_module`        | ç¦ç”¨ ngx\_http\_limit\_zone\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—å¯ä»¥é’ˆå¯¹æ¡ä»¶ï¼Œè¿›è¡Œä¼šè¯çš„å¹¶å‘è¿æ¥æ•°æ§åˆ¶ï¼‰                                                |
| `--without-http_limit_req_module`        | ç¦ç”¨ ngx\_http\_limit\_req\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—å…è®¸ä½ å¯¹äºä¸€ä¸ªåœ°å€è¿›è¡Œè¯·æ±‚æ•°é‡çš„é™åˆ¶ç”¨ä¸€ä¸ªç»™å®šçš„sessionæˆ–ä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶ï¼‰                             |
| `--without-http_empty_gif_module`        | ç¦ç”¨ `ngx_http_empty_gif_module` æ”¯æŒï¼ˆè¯¥æ¨¡å—åœ¨å†…å­˜ä¸­å¸¸é©»äº†ä¸€ä¸ª1\*1çš„é€æ˜GIFå›¾åƒï¼Œå¯ä»¥è¢«éå¸¸å¿«é€Ÿçš„è°ƒç”¨ï¼‰                                      |
| `--without-http_browser_module`          | ç¦ç”¨ ngx\_http\_browser\_module æ”¯æŒ                                                                            |
| `--without-http_upstream_ip_hash_module` | ç¦ç”¨ ngx\_http\_upstream\_ip\_hash\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨äºç®€å•çš„è´Ÿè½½å‡è¡¡ï¼‰                                                   |
| `--with-http_perl_module`                | å¯ç”¨ ngx\_http\_perl\_module æ”¯æŒï¼ˆè¯¥æ¨¡å—ä½¿nginxå¯ä»¥ç›´æ¥ä½¿ç”¨perlæˆ–é€šè¿‡ssiè°ƒç”¨perlï¼‰                                              |
| `--with-perl_modules_path=`              | è®¾å®š perl æ¨¡å—è·¯å¾„                                                                                                |
| `--http-log-path=`                       | è®¾å®š access log è·¯å¾„                                                                                            |
| `--http-client-body-temp-path=`          | è®¾å®š HTTP å®¢æˆ·ç«¯è¯·æ±‚ä¸´æ—¶æ–‡ä»¶è·¯å¾„                                                                                         |
| `--http-proxy-temp-path=`                | è®¾å®š HTTP ä»£ç†ä¸´æ—¶æ–‡ä»¶è·¯å¾„                                                                                            |
| `--http-fastcgi-temp-path=`              | è®¾å®š HTTP Fastcgi ä¸´æ—¶æ–‡ä»¶è·¯å¾„                                                                                      |
| `--http-uwsgi-temp-path=`                | è®¾å®š HTTP uwsgi ä¸´æ—¶æ–‡ä»¶è·¯å¾„                                                                                        |
| `--http-scgi-temp-path=`                 | è®¾å®š HTTP scgi ä¸´æ—¶æ–‡ä»¶è·¯å¾„                                                                                         |
| `--without-http`                         | ç¦ç”¨ HTTP server åŠŸèƒ½                                                                                           |
| `--without-http-cache`                   | ç¦ç”¨ HTTP Cache åŠŸèƒ½                                                                                            |
| `--with-mail`                            | å¯ç”¨ POP3/IMAP4/SMTP ä»£ç†æ¨¡å—æ”¯æŒ                                                                                   |
| `--with-mail_ssl_module`                 | å¯ç”¨ ngx\_mail\_ssl\_module æ”¯æŒ                                                                                |
| `--without-mail_pop3_module`             | ç¦ç”¨ POP3 åè®®                                                                                                  |
| `--without-mail_imap_module`             | ç¦ç”¨ IMAP åè®®                                                                                                  |
| `--without-mail_smtp_module`             | ç¦ç”¨ SMTP åè®®                                                                                                  |
| `--with-google_perftools_module`         | å¯ç”¨ ngx\_google\_perftools\_module æ”¯æŒï¼ˆè°ƒè¯•ç”¨ï¼Œå‰–æç¨‹åºæ€§èƒ½ç“¶é¢ˆï¼‰                                                          |
| `--with-cpp_test_module`                 | å¯ç”¨ ngx\_cpp\_test\_module æ”¯æŒ                                                                                |

>

- Mainline version å¼€å‘ç‰ˆ
- Stable version ç¨³å®šç‰ˆ
- Legacy version å†å²ç‰ˆæœ¬

**3. Nginx æ ¸å¿ƒé…ç½®æ–‡ä»¶**
Nginx çš„ä¸»è¦é…ç½®æ–‡ä»¶æ˜¯ `nginx.conf`ï¼ˆé€šå¸¸ä½äº `/etc/nginx/nginx.conf`ï¼‰ï¼Œç»“æ„å¦‚ä¸‹ï¼š

nginx

å¤åˆ¶

```nginx
# å…¨å±€é…ç½®ï¼ˆå½±å“æ‰€æœ‰æ¨¡å—ï¼‰
user nginx;
worker_processes auto;

events {
    worker_connections 1024;  # æ¯ä¸ª worker çš„æœ€å¤§è¿æ¥æ•°
}

http {
    # HTTP æœåŠ¡å™¨é…ç½®
    server {
        listen 80;
        server_name example.com;
        root /var/www/html;
    }
}

stream {
    # TCP/UDP ä»£ç†é…ç½®ï¼ˆå¦‚ MySQLã€Redisï¼‰
    server {
        listen 3306;
        proxy_pass backend_db:3306;
    }
}
```

***

**4. å¸¸ç”¨ Nginx å‘½ä»¤**

| å‘½ä»¤                      | ä½œç”¨                |
| ----------------------- | ----------------- |
| `nginx -t`              | æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•          |
| `nginx -s reload`       | é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸é‡å¯ï¼‰       |
| `nginx -s stop`         | ç«‹å³åœæ­¢              |
| `systemctl start nginx` | å¯åŠ¨ Nginxï¼ˆSystemdï¼‰ |
| `journalctl -u nginx`   | æŸ¥çœ‹æ—¥å¿—ï¼ˆSystemdï¼‰     |

***

**5. Nginx é€‚ç”¨åœºæ™¯**
âœ… é™æ€ç½‘ç«™æ‰˜ç®¡ï¼ˆå¦‚åšå®¢ã€å®˜ç½‘ï¼‰
âœ… åå‘ä»£ç†ï¼ˆéšè—åç«¯æœåŠ¡å™¨ï¼‰
âœ… è´Ÿè½½å‡è¡¡ï¼ˆå¤šå°æœåŠ¡å™¨åˆ†æµï¼‰
âœ… API ç½‘å…³ï¼ˆè·¯ç”±ä¸åŒå¾®æœåŠ¡ï¼‰
âœ… CDN è¾¹ç¼˜èŠ‚ç‚¹ï¼ˆç¼“å­˜é™æ€èµ„æºï¼‰
âœ… TCP/UDP ä»£ç†ï¼ˆå¦‚ MySQLã€æ¸¸æˆæœåŠ¡å™¨ï¼‰

***

**6. æ€»ç»“**

- Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€è½»é‡çº§çš„ Web æœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚

- é€‚åˆé«˜å¹¶å‘ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜åŠ é€Ÿç­‰åœºæ™¯ã€‚

- æ¯” Apache æ›´èŠ‚çœèµ„æºï¼Œä½†åŠ¨æ€å†…å®¹éœ€é…åˆåç«¯ï¼ˆå¦‚ PHP-FPMï¼‰ã€‚

- é…ç½®æ–‡ä»¶ç®€å•ï¼Œæ˜“äºç®¡ç†ã€‚

å¦‚æœä½ éœ€è¦ä¸€ä¸ª å¿«é€Ÿã€ç¨³å®šã€å¯æ‰©å±• çš„ Web æœåŠ¡å™¨ï¼ŒNginx æ˜¯ä¸€ä¸ªç»ä½³é€‰æ‹©ï¼ ğŸš€

**5. é…ç½® HTTPS**
â€‹**â€‹(1) ç”Ÿæˆ SSL è¯ä¹¦ï¼ˆè‡ªç­¾åï¼‰â€‹**â€‹

bash

å¤åˆ¶

```bash
sudo mkdir -p /etc/nginx/conf/ssl
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout /etc/nginx/conf/ssl/nginx.key \
    -out /etc/nginx/conf/ssl/nginx.crt
```

> è¯´æ˜ï¼š
>
> - å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨ Let's Encrypt æˆ– é˜¿é‡Œäº‘ SSL è¯ä¹¦ã€‚

**(2) ä¿®æ”¹ Nginx é…ç½®**
ç¼–è¾‘ `/etc/nginx/conf/nginx.conf`ï¼Œåœ¨ `server` å—ä¸­æ·»åŠ  HTTPS é…ç½®ï¼š

nginx

å¤åˆ¶

```nginx
server {
    listen 443 ssl;
    server_name your_domain.com;

    ssl_certificate /etc/nginx/conf/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/conf/ssl/nginx.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    location / {
        root html;
        index index.html index.htm;
    }
}

server {
    listen 80;
    server_name your_domain.com;
    return 301 https://$host$request_uri;
}
```

**(3) é‡å¯ Nginx**

bash

å¤åˆ¶

```bash
sudo systemctl restart nginx
```

***

**6. éªŒè¯ HTTPS**
è®¿é—® `https://your_domain.com`ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šæç¤ºè¯ä¹¦ä¸å®‰å…¨ï¼ˆè‡ªç­¾åè¯ä¹¦ï¼‰ï¼Œä½†è¿æ¥åº”è¯¥æ˜¯åŠ å¯†çš„ã€‚

***

**7. é˜²ç«å¢™æ”¾è¡Œï¼ˆå¯é€‰ï¼‰**
å¦‚æœä½¿ç”¨é˜¿é‡Œäº‘å®‰å…¨ç»„æˆ– `firewalld`ï¼Œç¡®ä¿æ”¾è¡Œ 80 å’Œ 443 ç«¯å£ï¼š

bash

å¤åˆ¶

```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

***

**æ€»ç»“**

- å·²ç¼–è¯‘å®‰è£… Nginx å¹¶å¯ç”¨ HTTPS æ”¯æŒã€‚

- é…ç½®äº†è‡ªç­¾å SSL è¯ä¹¦ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ CA ç­¾å‘çš„è¯ä¹¦ï¼‰ã€‚

- è®¾ç½®äº† HTTP è‡ªåŠ¨è·³è½¬ HTTPSã€‚

- ä½¿ç”¨ `systemd` ç®¡ç† Nginx æœåŠ¡ã€‚

å¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥æ£€æŸ¥æ—¥å¿—ï¼š

bash

å¤åˆ¶

```bash
sudo tail -f /etc/nginx/logs/error.log
```

## Nginx é…ç½®

### æœ€å°é…ç½®æ–‡ä»¶

```sh
sudo tee /etc/nginx/nginx.conf <<'EOF'
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    access_log /var/log/nginx/access.log;
    sendfile on;
    keepalive_timeout 65;
    include /etc/nginx/conf.d/*.conf;
}
EOF
```

### é…ç½®æ‹†åˆ†

1. å¯ä»¥å°† Nginx çš„é…ç½®æ–‡ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªå­æ–‡ä»¶ï¼Œé€šè¿‡ `include` æŒ‡ä»¤ç»„ç»‡ç®¡ç†

   - ä¸»é…ç½®æ–‡ä»¶ `nginx.conf`ï¼šä¿ç•™æ ¸å¿ƒé…ç½®ï¼ˆå…¨å±€å‚æ•°ã€äº‹ä»¶æ¨¡å—ã€HTTP æ¨¡å—å…¥å£ï¼‰ã€‚

   - å­é…ç½®æ–‡ä»¶ï¼šæŒ‰åŠŸèƒ½æˆ–åŸŸåæ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ç‹¬ç«‹ç›®å½•ä¸­ã€‚

   - é€šç”¨é…ç½®ï¼šå¦‚ `gzip`ã€`ssl`ã€æ—¥å¿—æ ¼å¼ç­‰ã€‚

   - è™šæ‹Ÿä¸»æœºé…ç½®ï¼šæ¯ä¸ªåŸŸå/åº”ç”¨å•ç‹¬ä¸€ä¸ªæ–‡ä»¶ã€‚

   - æ¨¡å—åŒ–é…ç½®ï¼šå¦‚è´Ÿè½½å‡è¡¡ã€ç¼“å­˜è§„åˆ™ç­‰ã€‚

2. ç›®å½•ç»“æ„å»ºè®®

   ```sh
   /etc/nginx/conf
   â”œâ”€â”€ nginx.conf               # ä¸»é…ç½®æ–‡ä»¶
   â”œâ”€â”€ conf.d/                  # é€šç”¨é…ç½®ç‰‡æ®µ
   â”‚   â”œâ”€â”€ gzip.conf
   â”‚   â”œâ”€â”€ ssl.conf
   â”‚   â””â”€â”€ log_format.conf
   â”œâ”€â”€ sites-available/         # æ‰€æœ‰è™šæ‹Ÿä¸»æœºé…ç½®ï¼ˆå­˜æ”¾å…¨éƒ¨é…ç½®ï¼‰
   â”‚   â”œâ”€â”€ example.com.conf
   â”‚   â””â”€â”€ api.example.com.conf
   â”œâ”€â”€ sites-enabled/           # å¯ç”¨çš„è™šæ‹Ÿä¸»æœºé…ç½®ï¼ˆè½¯é“¾æ¥åˆ° sites-availableï¼‰
   â””â”€â”€ modules/                 # æ¨¡å—åŒ–é…ç½®ï¼ˆå¯é€‰ï¼‰
       â”œâ”€â”€ proxy.conf
       â””â”€â”€ cache.conf
   ```

### æ‹†åˆ†æ­¥éª¤

- **æ­¥éª¤ 1ï¼šå¤‡ä»½åŸé…ç½®**

  ```sh
  cp /etc/nginx/conf/nginx.conf /etc/nginx/conf/nginx.conf.bak
  ```

- **æ­¥éª¤ 2ï¼šä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ `nginx.conf`**
  ä¿ç•™æ ¸å¿ƒé…ç½®ï¼Œç”¨ `include` å¯¼å…¥å­æ–‡ä»¶ï¼š

  ```sh
  # å…¨å±€é…ç½®
  user  nginx;
  worker_processes  auto;

  events {
      worker_connections  1024;
  }

  http {
      # åŸºç¡€é…ç½®
      include       /etc/nginx/conf/mime.types;
      default_type  application/octet-stream;

      # å¯¼å…¥é€šç”¨é…ç½®
      include /etc/nginx/conf/conf.d/*.conf;

      # å¯¼å…¥è™šæ‹Ÿä¸»æœºé…ç½®
      include  /etc/nginx/conf/sites-enabled/*.conf;
  }
  ```

- **æ­¥éª¤ 3ï¼šåˆ›å»ºå­é…ç½®æ–‡ä»¶**

  - é€šç”¨é…ç½®ç¤ºä¾‹ï¼ˆ`conf.d/gzip.conf`ï¼‰ï¼š

    ```sh
    gzip on;
    gzip_types text/plain text/css application/json;
    ```

  - è™šæ‹Ÿä¸»æœºç¤ºä¾‹ï¼ˆ`sites-available/fulsun.local.conf`ï¼‰ï¼š

    ```sh
    server {
        listen 80;
        server_name fulsun.local;
        root /var/www/fulsun.local;

        location / {
            try_files $uri $uri/ =404;
        }
    }
    ```

- **æ­¥éª¤ 4ï¼šå¯ç”¨è™šæ‹Ÿä¸»æœº**

  ```sh
  # åˆ›å»ºè½¯é“¾æ¥ï¼ˆä»¥å¯ç”¨ example.com.confï¼‰
  ln -s /etc/nginx/conf/sites-available/fulsun.local.conf /etc/nginx/conf/sites-enabled/
  ```

- **æ­¥éª¤ 5ï¼šæ£€æŸ¥å¹¶é‡è½½é…ç½®**

  ```sh
  nginx -t         # æµ‹è¯•é…ç½®è¯­æ³•
  nginx -s reload  # é‡è½½é…ç½®
  ```

### é«˜çº§æ‹†åˆ†ï¼ˆæŒ‰æ¨¡å—)

- è´Ÿè½½å‡è¡¡é…ç½®ï¼ˆ`modules/proxy.conf`ï¼‰ï¼š

  ```sh
  upstream backend {
      server 10.0.0.1:8080;
      server 10.0.0.2:8080;
  }
  ```

- åœ¨è™šæ‹Ÿä¸»æœºä¸­å¼•ç”¨ï¼š

  ```sh
  server {
      location / {
          proxy_pass http://backend;
          include /etc/nginx/modules/proxy.conf;  # åŒ…å«ä»£ç†ç›¸å…³é…ç½®
      }
  }
  ```
